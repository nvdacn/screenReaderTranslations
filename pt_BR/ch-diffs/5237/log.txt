------------------------------------------------------------
revno: 5237
committer: Michael Curran <mick@kulgan.net>
branch nick: main
timestamp: Wed 2012-07-04 15:54:15 +1000
message:
  NVDA will no longer freeze on XP when copying the current user config to the system config (via the General Settings dialog). Instead it will correctly  show a please wait dialog with beeps. (#2485). It will also ask the user to retry or cancel if a particular file cannot be copied, plus speed of copying files may be slightly improved. 
  Specific changes:
  	* installer.tryRemoveFile: when removing a directory, use shuil.rmtree rather than os.rmdir as this does allow tryRemoveFile to be called for a directory that is not empty.
  	* nvda_slave: catch installer.RetriableFailure for any of the slave commands, not just  for install.
  	* config._setSystemConfigToCurrentConfig: use installer.tryRemoveFile and installer.tryCopyFile to remove the old files and copy the new ones so that failures can be retried if wished. tryRemoveFile also allows waiting a bit longer for a possible secure desktop NVDA to exit before removing the system config directory.
  	* config.setSystemConfigToCurrentConfig: Use the isUserAnAdmin windows API function to work out whether _setSystemConfigToCurrentConfig can be called directlry or slave should be used. Previously this was worked out if there was an exception in the former, but now errors like this would cause RetriableFailure. Also raise RetriableFailure if slave returns error 2 (retriableFailure).
  	* gui.settingsDialogs: When copying current config to system config (via the General settings dialog), use gui.ExecAndPump so that NVDA does not freeze in situations where copying settings can be done without slave. Also bring up a retry cancel dialog if there is a retriable failure allowing the user to retry the copy. 
