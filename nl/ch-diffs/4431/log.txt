------------------------------------------------------------
revno: 4431
committer: Michael Curran <mick@kulgan.net>
branch nick: main
timestamp: Fri 2011-06-10 12:28:56 +1000
message:
  Improve NVDA's support for announcing embedded objects in rich text. This most importantly allows NVDA to announce the recipiants in the To/CC/BCC fields in Microsoft Outlook. Specific changes:
  * NVDAObjects.window.edit.ITextDocumentTextInfo: split out the code that tries to get a label for an embedded object in to its own _getEmbeddedObjectLabel method to make code cleaner.
   * NVDAObjects.window.edit.ITextdocumentTextInfo:  completely rewrite how we get a label for an embedded object. The rule is now: 1. try queryInterface to IAccessible on the embeded object and if  successful use accName as the label. This works in MS Outlook 2007 and above. 2. Use displayModel to get the screen text within the bounding rectangle of the embedded object range. 3.  QueryInterface to IOleObject and use getUserType to make the label. No longer at all try using IDataObject.getData and friends as it is too unpredictable and does not work everywhere.
  So as said above: Outlook 2007 and above should use IAccessible::accName. Outlook Express / Outlook pre 2007 will use displayModel. And any other embedded object that does not actually have detectable screen text will use getUserType, which is a description of the object type (e.g. Outlook recipiant).
   * NVDAObjects.window.edit.Edit.TextInfo: if the editAPI is greater than 1 and the window class name ends with 'PT'  its safe to use ITextDocument, even if useITextDocumentSupport is false. Outlook uses RichEdit20WPT and probably other versions, but most likely they all end in PT.
  Fixes #864.
